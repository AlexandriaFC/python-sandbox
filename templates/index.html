<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Address Autocomplete</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- 1) Define the initMap callback BEFORE loading the API -->
  <script>
    async function initMap() {
      // 2) Import the Places library
      await google.maps.importLibrary("places");
      // 3) Create the autocomplete widget
      const placeAutocomplete = new google.maps.places.PlaceAutocompleteElement();
      // 4) Insert it into our form
      document.getElementById("autocomplete-container")
              .appendChild(placeAutocomplete);

      // 5) When the user picks an address, capture it into the hidden field
      placeAutocomplete.addEventListener("gmp-select", async ({ placePrediction }) => {
        const place = placePrediction.toPlace();
        await place.fetchFields({ fields: ["formattedAddress"] });
        document.getElementById("address-value").value = place.formattedAddress;
      });
    }
  </script>

  <!-- 2) Load the Maps JS API with Places library and our callback -->
  <script
    src="https://maps.googleapis.com/maps/api/js?
         key=AIzaSyCXaaG2c6zzMxbvWwVQ6ccWoJ2-TEvm_8A
         &libraries=places
         &v=weekly
         &callback=initMap"
    async
    defer
  ></script>
</head>

<body>
  <h1>Enter your address</h1>

  {% if success %}
    <p class="success">Successfully submitted!</p>
  {% endif %}

  <form action="/" method="post">
    <!-- This div will get the auto-input appended -->
    <div id="autocomplete-container"></div>
    <!-- Hidden input actually sent to Flask -->
    <input type="hidden" name="address" id="address-value" />
    <button type="submit">Save</button>
  </form>
</body>
</html>
