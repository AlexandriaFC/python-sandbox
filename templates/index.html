<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Address Autocomplete</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- 1) Define the init callback before loading the API -->
  <script>
    window.initAutocomplete = async () => {
      // Load the new Places library and pull out the widget class
      const { PlaceAutocompleteElement } = await google.maps.importLibrary("places");
      // Create the widget
      const autocompleteEl = new PlaceAutocompleteElement();
      autocompleteEl.placeholder = "Start typing your addressâ€¦";
      // Restrict to US addresses
      autocompleteEl.componentRestrictions = { country: "US" };
      // Put it into our container
      document.getElementById("autocomplete-container")
              .appendChild(autocompleteEl);

      // Grab the hidden input so we can store the selection
      const hiddenInput = document.getElementById("address-value");

      // When user picks an address, fill the hidden field
      autocompleteEl.addEventListener("gmp-select", async ({ placePrediction }) => {
        const place = placePrediction.toPlace();
        // Fetch the formatted_address field
        await place.fetchFields({ fields: ["formattedAddress"] });
        hiddenInput.value = place.formattedAddress;
      });
    };
  </script>

  <!-- 2) Load the Maps API with callback to our init -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXaaG2c6zzMxbvWwVQ6ccWoJ2-TEvm_8A&v=weekly&callback=initAutocomplete"
    async defer
  ></script>
</head>

<body>
  <h1>Enter your address</h1>

  {% if success %}
    <p class="success">Successfully submitted!</p>
  {% endif %}

  <form action="/" method="post">
    <!-- Container for the autocomplete widget -->
    <div id="autocomplete-container"></div>
    <!-- Hidden input to actually submit the chosen address -->
    <input type="hidden" name="address" id="address-value" />
    <button type="submit">Save</button>
  </form>
</body>
</html>
